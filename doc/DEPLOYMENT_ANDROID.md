# üì± Gu√≠a de Deployment Android - RRVendor
## Distribuci√≥n Privada e Interna

**Proyecto**: RRVendor - Romero Repuestos
**Plataforma**: Android Only
**Tipo de Distribuci√≥n**: Privada/Internal (sin Google Play Store)
**M√©todo**: EAS Build + Local Builds + OTA Updates

---

## üìã Tabla de Contenidos

1. [Configuraci√≥n Inicial EAS](#configuraci√≥n-inicial-eas)
2. [Builds Locales Android](#builds-locales-android)
3. [OTA Updates](#ota-updates)
4. [M√©todos de Distribuci√≥n](#m√©todos-de-distribuci√≥n)
5. [Backup y Export](#backup-y-export)
6. [Troubleshooting](#troubleshooting)

---

## üöÄ Configuraci√≥n Inicial EAS

### Paso 1: Instalar EAS CLI

```bash
# Instalar globalmente
npm install -g eas-cli

# Verificar instalaci√≥n
eas --version
```

### Paso 2: Login en Expo

```bash
# Crear cuenta o login
eas login

# Verificar sesi√≥n
eas whoami
```

### Paso 3: Configurar Proyecto

```bash
# En la ra√≠z del proyecto
eas build:configure

# Cuando pregunte por plataformas:
# ‚úÖ Seleccionar SOLO Android
# ‚ùå NO seleccionar iOS
```

Esto crear√° dos archivos:
- `eas.json` - Configuraci√≥n de builds
- `.easignore` - Archivos a ignorar en builds

---

## ‚öôÔ∏è Configuraci√≥n de eas.json

### Configuraci√≥n Recomendada para RRVendor

```json
{
  "cli": {
    "version": ">= 5.0.0"
  },
  "build": {
    "development": {
      "developmentClient": true,
      "distribution": "internal",
      "android": {
        "gradleCommand": ":app:assembleDebug",
        "buildType": "apk"
      }
    },
    "preview": {
      "distribution": "internal",
      "android": {
        "buildType": "apk"
      }
    },
    "production": {
      "distribution": "internal",
      "android": {
        "buildType": "apk"
      }
    }
  },
  "submit": {
    "production": {}
  }
}
```

### Explicaci√≥n de Perfiles

- **development**: Para desarrollo, incluye Expo Dev Client
- **preview**: Para testing interno (recomendado para distribuci√≥n privada)
- **production**: Para versi√≥n final (tambi√©n privada en tu caso)

---

## üì¶ Builds Locales Android

### ¬øPor qu√© Builds Locales?

‚úÖ **Control total** del APK
‚úÖ **Privacidad** - APK en tu m√°quina
‚úÖ **Distribuci√≥n inmediata** - no esperas queue de Expo
‚úÖ **Gratis** - sin l√≠mites de builds

### Build Local - Comando B√°sico

```bash
# Build de preview (recomendado para distribuci√≥n privada)
eas build --platform android --profile preview --local

# El APK se genera en tu m√°quina
# Ubicaci√≥n t√≠pica: ./build-xxxxxxxxxxxxx.apk
```

### Build Production Local

```bash
eas build --platform android --profile production --local
```

### Primera Build - Qu√© Esperar

La primera vez que hagas un build:

1. **Crear√° keystore autom√°ticamente** (se guarda en Expo)
2. **Descargar√° dependencias** (puede tardar 10-15 minutos)
3. **Compilar√° el proyecto**
4. **Generar√° el APK**

Builds subsecuentes son m√°s r√°pidas (5-10 minutos).

---

## üì± Instalaci√≥n del APK en Dispositivos

### M√©todo 1: USB (Desarrollo)

```bash
# Con dispositivo conectado por USB
adb install build-xxxxxxxxxxxxx.apk

# Si hay versi√≥n anterior instalada
adb install -r build-xxxxxxxxxxxxx.apk
```

### M√©todo 2: Compartir APK Directamente

1. **Copiar APK a Google Drive / Dropbox**
2. **Compartir link** con usuarios
3. Usuario descarga en Android
4. Usuario habilita "Fuentes desconocidas"
5. Usuario instala APK

### M√©todo 3: Self-Hosting

#### Opci√≥n A: Firebase Hosting (Gratis)

```bash
# Instalar Firebase CLI
npm install -g firebase-tools

# Login
firebase login

# Inicializar proyecto
firebase init hosting

# Copiar APK a public/
cp build-xxxxxxxxxxxxx.apk public/rrvendor-v1.0.0.apk

# Deploy
firebase deploy --only hosting

# Tu APK estar√° en:
# https://tu-proyecto.web.app/rrvendor-v1.0.0.apk
```

#### Opci√≥n B: GitHub Releases (Privado)

```bash
# En repo privado de GitHub
gh release create v1.0.0 build-xxxxxxxxxxxxx.apk \
  --title "RRVendor v1.0.0" \
  --notes "Release inicial"

# Compartir link del release (requiere acceso al repo)
```

---

## üîÑ OTA Updates (Over-The-Air)

### ¬øQu√© son las OTA Updates?

Las **OTA Updates** permiten actualizar el c√≥digo JavaScript/TypeScript de tu app **sin generar un nuevo APK**.

**Casos de uso:**
- ‚úÖ Fixes de bugs
- ‚úÖ Cambios de UI
- ‚úÖ Nueva l√≥gica de negocio
- ‚úÖ Actualizaci√≥n de texto/traducciones

**NO funciona para:**
- ‚ùå Agregar librer√≠as nativas nuevas
- ‚ùå Cambiar permisos de Android
- ‚ùå Actualizar versi√≥n de React Native
- ‚ùå Cambios en `android/` folder

### Configuraci√≥n de Updates

#### 1. Instalar expo-updates

```bash
npx expo install expo-updates
```

#### 2. Configurar app.json

```json
{
  "expo": {
    "updates": {
      "url": "https://u.expo.dev/[your-project-id]"
    },
    "runtimeVersion": {
      "policy": "appVersion"
    }
  }
}
```

#### 3. Crear Branches

```bash
# Branch para preview
eas update:configure

# Esto preguntar√° por branches
# Crear: preview, production
```

### Publicar OTA Update

```bash
# Update para branch preview
eas update --branch preview --message "Fix en b√∫squeda de productos"

# Update para branch production
eas update --branch production --message "Mejoras en ventas"
```

### C√≥mo Reciben Updates los Usuarios

Los dispositivos **autom√°ticamente descargan updates** cuando:
1. La app se reinicia
2. La app vuelve a primer plano despu√©s de 30 minutos

**O forzar check manual:**

```typescript
// En tu c√≥digo
import * as Updates from 'expo-updates';

async function checkForUpdates() {
  try {
    const update = await Updates.checkForUpdateAsync();
    if (update.isAvailable) {
      await Updates.fetchUpdateAsync();
      await Updates.reloadAsync();
    }
  } catch (error) {
    console.error('Error checking updates:', error);
  }
}
```

---

## üìã Workflow Recomendado de Deployment

### Escenario 1: Primera Instalaci√≥n

```bash
# 1. Build local
eas build --platform android --profile preview --local

# 2. Renombrar para versi√≥n
mv build-xxxxx.apk rrvendor-v1.0.0.apk

# 3. Subir a Drive/Firebase/etc
# (copiar a carpeta compartida)

# 4. Compartir link por WhatsApp/Email
```

### Escenario 2: Actualizaci√≥n Menor (Solo JS/UI)

```bash
# Sin rebuild - OTA Update
eas update --branch preview --message "Fix en c√°lculo de totales"

# Los dispositivos reciben el update autom√°ticamente
# ¬°Listo en segundos!
```

### Escenario 3: Actualizaci√≥n con Cambios Nativos

```bash
# Requiere nuevo APK
eas build --platform android --profile preview --local

# Renombrar y distribuir nueva versi√≥n
mv build-xxxxx.apk rrvendor-v1.1.0.apk

# Compartir con usuarios
# Deben desinstalar versi√≥n anterior e instalar nueva
```

---

## üíæ Backup y Export de Datos

### Export de Base de Datos SQLite

```typescript
// src/utils/backup.ts
import * as FileSystem from 'expo-file-system';
import * as Sharing from 'expo-sharing';

export async function exportDatabase() {
  try {
    // Ubicaci√≥n de la BD SQLite
    const dbPath = `${FileSystem.documentDirectory}SQLite/rrvendor.db`;

    // Crear backup con timestamp
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    const backupName = `rrvendor-backup-${timestamp}.db`;
    const backupPath = `${FileSystem.documentDirectory}${backupName}`;

    // Copiar BD
    await FileSystem.copyAsync({
      from: dbPath,
      to: backupPath
    });

    // Compartir (WhatsApp, Drive, Email, etc.)
    if (await Sharing.isAvailableAsync()) {
      await Sharing.shareAsync(backupPath, {
        mimeType: 'application/x-sqlite3',
        dialogTitle: 'Exportar Backup de Base de Datos'
      });
    }

    return backupPath;
  } catch (error) {
    console.error('Error exporting database:', error);
    throw error;
  }
}
```

### Import de Base de Datos

```typescript
// src/utils/backup.ts
import * as DocumentPicker from 'expo-document-picker';

export async function importDatabase() {
  try {
    // Seleccionar archivo
    const result = await DocumentPicker.getDocumentAsync({
      type: 'application/x-sqlite3',
      copyToCacheDirectory: true
    });

    if (result.type === 'success') {
      const dbPath = `${FileSystem.documentDirectory}SQLite/rrvendor.db`;

      // Copiar archivo seleccionado a ubicaci√≥n de BD
      await FileSystem.copyAsync({
        from: result.uri,
        to: dbPath
      });

      console.log('Database imported successfully');
      return true;
    }

    return false;
  } catch (error) {
    console.error('Error importing database:', error);
    throw error;
  }
}
```

### Instalar Dependencias para Backup

```bash
npx expo install expo-file-system
npx expo install expo-sharing
npx expo install expo-document-picker
```

---

## üìù Configuraci√≥n de app.json para Android

### Configuraci√≥n Completa Recomendada

```json
{
  "expo": {
    "name": "RRVendor",
    "slug": "rrvendor",
    "version": "1.0.0",
    "orientation": "portrait",
    "platforms": ["android"],
    "icon": "./assets/icon.png",
    "userInterfaceStyle": "automatic",
    "splash": {
      "image": "./assets/splash.png",
      "resizeMode": "contain",
      "backgroundColor": "#3182ce"
    },
    "assetBundlePatterns": [
      "**/*"
    ],
    "android": {
      "package": "com.romerorepuestos.rrvendor",
      "versionCode": 1,
      "adaptiveIcon": {
        "foregroundImage": "./assets/adaptive-icon.png",
        "backgroundColor": "#3182ce"
      },
      "permissions": [
        "INTERNET",
        "READ_EXTERNAL_STORAGE",
        "WRITE_EXTERNAL_STORAGE"
      ],
      "softwareKeyboardLayoutMode": "pan"
    },
    "plugins": [
      "expo-router",
      "expo-sqlite",
      [
        "expo-build-properties",
        {
          "android": {
            "compileSdkVersion": 34,
            "targetSdkVersion": 34,
            "buildToolsVersion": "34.0.0"
          }
        }
      ]
    ],
    "experiments": {
      "typedRoutes": true
    },
    "updates": {
      "url": "https://u.expo.dev/[your-project-id]"
    },
    "runtimeVersion": {
      "policy": "appVersion"
    },
    "extra": {
      "router": {
        "origin": false
      },
      "eas": {
        "projectId": "[your-project-id]"
      }
    }
  }
}
```

---

## üé® Assets Android

### Im√°genes Necesarias

```
assets/
‚îú‚îÄ‚îÄ icon.png              # 1024x1024 (icono base)
‚îú‚îÄ‚îÄ adaptive-icon.png     # 1024x1024 (foreground)
‚îú‚îÄ‚îÄ splash.png            # 1284x2778 (splash screen)
‚îî‚îÄ‚îÄ favicon.png           # 48x48 (web favicon)
```

### Generar Icons Autom√°ticamente

Puedes usar herramientas online:
- https://www.appicon.co/
- https://icon.kitchen/

O crear manualmente con las especificaciones de Android.

---

## üîß Troubleshooting

### Error: "Unable to find a matching configuration"

**Soluci√≥n:**
```bash
# Limpiar cach√©
eas build:clear-cache

# Rebuild
eas build --platform android --profile preview --local --clear-cache
```

### Error: "Keystore not found"

**Soluci√≥n:**
```bash
# Generar nuevo keystore
eas credentials

# Seleccionar Android > Set up a new key
```

### APK no instala - "App not installed"

**Causas comunes:**
1. Versi√≥n anterior con firma diferente
   - **Soluci√≥n**: Desinstalar app anterior primero

2. Espacio insuficiente
   - **Soluci√≥n**: Liberar espacio en dispositivo

3. Permisos de instalaci√≥n
   - **Soluci√≥n**: Habilitar "Instalar apps desconocidas" para Chrome/Files

### OTA Updates no funcionan

**Checklist:**
- ‚úÖ `expo-updates` instalado
- ‚úÖ `runtimeVersion` configurado en app.json
- ‚úÖ Branch correcto en el build
- ‚úÖ Update publicado en el mismo branch
- ‚úÖ App se reinici√≥ despu√©s de publicar update

---

## üìä Versionado

### Convenci√≥n Recomendada

```
version: "X.Y.Z"
versionCode: incremental

X = Major (cambios grandes, breaking changes)
Y = Minor (nuevas features)
Z = Patch (bugs, fixes)
```

### Ejemplo de Evoluci√≥n

```json
// v1.0.0 - Release inicial
{
  "version": "1.0.0",
  "android": {
    "versionCode": 1
  }
}

// v1.0.1 - Fix bugs (OTA Update posible)
{
  "version": "1.0.1",
  "android": {
    "versionCode": 1  // mismo versionCode
  }
}

// v1.1.0 - Nueva feature (requiere nuevo APK)
{
  "version": "1.1.0",
  "android": {
    "versionCode": 2  // incrementar
  }
}
```

---

## üìö Recursos Adicionales

### Documentaci√≥n Oficial
- **EAS Build**: https://docs.expo.dev/build/introduction/
- **EAS Update**: https://docs.expo.dev/eas-update/introduction/
- **Internal Distribution**: https://docs.expo.dev/build/internal-distribution/

### Herramientas √ötiles
- **ADB Commands**: https://developer.android.com/tools/adb
- **Firebase Hosting**: https://firebase.google.com/docs/hosting
- **App Icon Generator**: https://icon.kitchen/

---

## üéØ Checklist de Deployment

### Primera Release

- [ ] Configurar EAS CLI
- [ ] Crear eas.json con perfil preview/production
- [ ] Configurar app.json con datos correctos
- [ ] Generar assets (icon, splash)
- [ ] Build local exitoso
- [ ] Testing en dispositivo f√≠sico
- [ ] Configurar m√©todo de distribuci√≥n (Drive/Firebase/etc)
- [ ] Compartir APK con usuarios

### Updates Subsecuentes

#### Si es cambio JS/UI solo:
- [ ] Verificar que NO hay cambios nativos
- [ ] Publicar OTA Update
- [ ] Verificar que dispositivos reciben update

#### Si hay cambios nativos:
- [ ] Incrementar versionCode en app.json
- [ ] Generar nuevo build local
- [ ] Testing completo
- [ ] Distribuir nuevo APK
- [ ] Notificar usuarios para actualizar

---

## üí° Tips y Best Practices

### 1. Nombrado de APKs
Usa nombres descriptivos con versi√≥n:
```
rrvendor-v1.0.0-preview.apk
rrvendor-v1.1.0-production.apk
```

### 2. Mant√©n Historial de APKs
Guarda todos los APKs en carpeta versionada:
```
builds/
‚îú‚îÄ‚îÄ v1.0.0/
‚îÇ   ‚îî‚îÄ‚îÄ rrvendor-v1.0.0.apk
‚îú‚îÄ‚îÄ v1.0.1/
‚îÇ   ‚îî‚îÄ‚îÄ rrvendor-v1.0.1.apk
‚îî‚îÄ‚îÄ v1.1.0/
    ‚îî‚îÄ‚îÄ rrvendor-v1.1.0.apk
```

### 3. Testing Antes de Distribuir
Siempre testea en dispositivo f√≠sico antes de compartir.

### 4. Comunicaci√≥n con Usuarios
Avisa a usuarios cuando haya:
- Nueva versi√≥n APK (requiere instalaci√≥n)
- OTA Update importante (solo reiniciar app)

### 5. Backup Regular
Implementa backup autom√°tico de BD cada semana.

---

*Documentaci√≥n actualizada: Octubre 2025*
*Proyecto: RRVendor - Romero Repuestos*
*Plataforma: Android Only*
